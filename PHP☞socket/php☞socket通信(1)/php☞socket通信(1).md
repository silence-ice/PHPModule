#php☞socket通信(1)
***

###什么是Socket？
>1.socket起源于UNIX，在Unix一切皆文件哲学的思想下，socket是一种"打开—读/写—关闭"模式的实现，服务器和客户端各自维护一个"文件"，在建立连接打开后，可以向自己文件写入内容供对方读取或者读取对方内容，通讯结束时关闭文件。
>
>2.我们知道两个进程如果需要进行通讯最基本的一个前提能能够唯一的标示一个进程，在本地进程通讯中我们可以使用PID来唯一标示一个进程，但PID只在本地唯一，网络中的两个进程PID冲突几率很大，这时候我们需要另辟它径了：
>
>>IP层的ip地址可以唯一标示主机。
>
>>TCP层协议和端口号可以唯一标示主机的一个进程。
>
>>我们可以利用ip地址＋协议＋端口号唯一标示网络中的一个进程。
>
>3.能够唯一标示网络中的进程后，它们就可以利用socket进行通信了，什么是socket呢？我们经常把socket翻译为套接字，socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口供应用层调用已实现进程在网络中通信。

###Socket在网络协议中所处的位置  
IMG

###Socket终端之间通信流程  
IMG  
>
1. 服务器根据地址类型（ipv4,ipv6）、socket类型、协议创建socket
2. 服务器为socket绑定ip地址和端口号
3. 服务器socket监听端口号请求，随时准备接收客户端发来的连接，这时候服务器的socket并没有被打开
	• 客户端创建socket
	• 客户端打开socket，根据服务器ip地址和端口号试图连接服务器socket
4. 服务器socket接收到客户端socket请求，被动打开，开始接收客户端请求，直到客户端返回连接信息。这时候socket进入阻塞状态，所谓阻塞即accept()方法一直到客户端返回连接信息后才返回，开始接收下一个客户端谅解请求
	• 客户端连接成功，向服务器发送连接状态信息
5. 服务器accept方法返回，连接成功
	• 客户端向socket写入信息
6. 服务器读取信息
	• 客户端关闭
7. 服务器端关闭


###三次握手和socket关系
>服务器socket与客户端socket建立连接的部分其实就是大名鼎鼎的三次握手  
IMG2
>
>>第一次握手：客户端尝试连接服务器，向服务器发送syn包（同步序列编号Synchronize Sequence Numbers），syn=j，客户端进入SYN_SEND状态等待服务器确认
>
>>第二次握手：服务器接收客户端syn包并确认（ack=j+1），同时向客户端发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态
>
>>第三次握手：第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手